# 箱子动作测试指南

本文档说明如何使用 `test-bot` 单独测试箱子相关的动作，不启用Agent。

## 启动测试机器人

```bash
# 开发模式（推荐，支持热重载）
pnpm test-bot

# 或使用编译后的版本
pnpm build
pnpm start:test
```

## 可用的箱子测试命令

所有命令都通过游戏内聊天发送，以 `!` 开头。

### 1. 查询箱子内容

```
!chest_query <x> <y> <z>
```

**示例**：
```
!chest_query -39 70 135
```

**功能**：
- 测试 `QueryContainerAction`
- 查询指定位置箱子的内容
- 显示物品种类和数量

**输出示例**：
```
🔍 测试查询箱子 (-39, 70, 135)...
✅ 查询成功!
箱子包含 3 种物品
物品: oak_log x16, stick x8, chest x1
```

### 2. 放入物品到箱子

```
!chest_put <x> <y> <z> <item> <count>
```

**示例**：
```
!chest_put -39 70 135 oak_log 5
```

**功能**：
- 测试 `ManageContainerAction` 的放入操作
- 从背包取出指定物品放入箱子
- 需要背包中有该物品

**输出示例**：
```
📦 测试放入 oak_log x5 到箱子 (-39, 70, 135)...
✅ 成功: 已放入 oak_log 5 个
```

### 3. 从箱子取出物品

```
!chest_take <x> <y> <z> <item> <count>
```

**示例**：
```
!chest_take -39 70 135 oak_log 3
```

**功能**：
- 测试 `ManageContainerAction` 的取出操作
- 从箱子取出指定物品到背包
- 需要箱子中有该物品

**输出示例**：
```
📤 测试取出 oak_log x3 从箱子 (-39, 70, 135)...
✅ 成功: 已取出 oak_log 3 个
```

### 4. 完整测试流程

```
!chest_test <x> <y> <z>
```

**示例**：
```
!chest_test -39 70 135
```

**功能**：
- 执行完整的箱子测试流程
- 自动测试查询、放入、再次查询、取回
- 使用背包中的第一个物品进行测试

**测试步骤**：
1. 查询箱子初始内容
2. 放入1个物品
3. 再次查询确认
4. 取回该物品
5. 报告测试结果

**输出示例**：
```
🧪 开始完整箱子测试 (-39, 70, 135)...
步骤 1: 查询箱子内容
✅ 查询成功
箱子包含 0 种物品
步骤 2: 放入 oak_sapling x1
✅ 放入成功
步骤 3: 再次查询确认
箱子现在包含 1 种物品
步骤 4: 取回 oak_sapling x1
✅ 取回成功
🎉 完整测试流程完成!
```

## 查看详细日志

测试过程中，所有日志会输出到控制台，带有详细的标记：

- `[QueryContainer]` - 查询容器相关日志
- `=== 开始箱子X测试 ===` - 测试开始标记
- `=== 箱子X测试完成 ===` - 测试完成标记

**关键日志示例**：
```
[QueryContainer] 当前到容器的距离: 1.13 格
[QueryContainer] 是否能看见容器: true
[QueryContainer] 开始打开容器: (-39, 70, 135)
[QueryContainer] 准备打开容器，当前距离: 1.13 格
[QueryContainer] 容器已打开，类型: chest
[QueryContainer] 容器查询成功，包含 0 种物品
[QueryContainer] 容器已关闭
```

## 常见问题排查

### 1. 窗口打开超时

**症状**：
```
Event windowOpen did not fire within timeout of 20000ms
```

**可能原因**：
- 距离太远（需要在4格以内）
- 视角被遮挡
- 上一个窗口未正确关闭
- 服务器响应延迟

**排查步骤**：
1. 使用 `!pos` 查看当前位置
2. 使用 `!move <x> <y> <z>` 移动到箱子附近
3. 重试命令

### 2. 物品不存在

**症状**：
```
背包中没有 oak_log
```

**解决方案**：
- 使用 `!status` 查看背包物品
- 确保指定的物品名称正确（使用英文名）
- 先采集或合成需要的物品

### 3. 箱子不存在

**症状**：
```
指定坐标处是 grass_block，不是容器
```

**解决方案**：
- 确认箱子坐标正确
- 使用 `!find chest` 寻找附近的箱子
- 使用 `!place chest` 放置一个箱子

## 测试建议

### 基础测试

1. 先测试查询：`!chest_query <x> <y> <z>`
2. 确认能成功打开箱子
3. 再测试放入和取出

### 压力测试

1. 连续多次查询：
   ```
   !chest_query -39 70 135
   !chest_query -39 70 135
   !chest_query -39 70 135
   ```
2. 快速放入取出：
   ```
   !chest_put -39 70 135 oak_log 1
   !chest_take -39 70 135 oak_log 1
   ```

### 边界测试

1. 测试大数量：`!chest_put -39 70 135 oak_log 64`
2. 测试不存在的物品：`!chest_take -39 70 135 diamond 1`
3. 测试空箱子：`!chest_test -39 70 135`

## 与Agent模式的区别

| 特性 | test-bot | Agent模式 |
|------|----------|----------|
| LLM决策 | ❌ 无 | ✅ 有 |
| GUI模式 | ❌ 无 | ✅ 有 |
| 直接动作 | ✅ 是 | ✅ 是 |
| 调试便利 | ✅ 高 | ⚠️ 中 |
| 测试隔离 | ✅ 完全隔离 | ❌ 有依赖 |

**推荐流程**：
1. 先在 test-bot 中调试动作是否正常工作
2. 确认无误后，再在 Agent 模式中测试完整流程
3. 如果 Agent 模式出问题，回到 test-bot 隔离测试

## 日志级别配置

修改 `config.toml` 的日志级别来控制输出详细程度：

```toml
[logging]
level = "INFO"  # 或 "DEBUG" 查看更多细节
```

- `DEBUG`: 显示所有日志，包括距离、视角等详细信息
- `INFO`: 显示主要操作和结果
- `WARN`: 只显示警告和错误

